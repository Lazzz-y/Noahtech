import{_ as t}from"./chunks/ArticleMetadata.Ba4icgGF.js";import{_ as p,m as e,a as F,u as r,B as d,e as n,x as g,ah as C,o as h,p as y,q as D}from"./chunks/framework.Bi-mNMmX.js";import"./chunks/theme.--nR5Zd2.js";const q=JSON.parse('{"title":"Redis哨兵模式","description":"","frontmatter":{"title":"Redis哨兵模式","author":"Noah","date":"2024/07/10 14:39","categories":["Redis进阶"],"tags":["Redis","Redis进阶"]},"headers":[],"relativePath":"courses/数据库/04-Redis进阶/06-Redis哨兵模式.md","filePath":"courses/数据库/04-Redis进阶/06-Redis哨兵模式.md","lastUpdated":1720612269000}'),o={name:"courses/数据库/04-Redis进阶/06-Redis哨兵模式.md"},c=n("h1",{id:"redis哨兵模式",tabindex:"-1"},[g("Redis哨兵模式 "),n("a",{class:"header-anchor",href:"#redis哨兵模式","aria-label":'Permalink to "Redis哨兵模式"'},"​")],-1),B=C(`<nav class="table-of-contents"><ul><li><a href="#哨兵模式概述">哨兵模式概述</a><ul><li><a href="#作用">作用</a></li><li><a href="#什么是哨兵模式">什么是哨兵模式</a></li><li><a href="#哨兵模式工作原理">哨兵模式工作原理</a></li><li><a href="#哨兵的功能">哨兵的功能</a></li></ul></li><li><a href="#单哨兵模式">单哨兵模式</a><ul><li><a href="#_1-创建sentinel-conf">1.创建sentinel.conf</a></li><li><a href="#_2-修改sentinel-conf">2.修改sentinel.conf</a></li><li><a href="#_3-启动哨兵">3.启动哨兵</a></li><li><a href="#_5-测试哨兵">5.测试哨兵</a></li></ul></li></ul></nav><details class="details custom-block"><summary>哨兵模式重要配置</summary><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Example sentinel.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 哨兵sentinel实例运行的端口 默认26379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 26379</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 哨兵sentinel的工作目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 哨兵sentinel监控的redis主节点的 ip port</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># master-name 可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># quorum 配置多少个sentinel哨兵统一认为master主节点失联 那么这时客观上认为主节点失联了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> auth-pass</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> MySUPER--secret-0123passw0rd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> down-after-milliseconds</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 30000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">这个数字越小，完成failover所需的时间就越长，</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">但是如果这个数字越大，就意味着越</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 多的slave因为replication而不可用。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">可以通过将这个值设为</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 来保证每次只有一个slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 处于不能处理命令请求的状态。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> parallel-syncs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#3.当想要取消一个正在进行的failover所需要的时间。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 默认三分钟</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> failover-timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 180000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># SCRIPTS EXECUTION</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#对于脚本的运行结果有以下规则：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#通知脚本</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># shell编程</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> notification-script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/redis/notify.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 客户端重新配置主节点参数脚本</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 以下参数将会在调用脚本时传给脚本:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 目前&lt;state&gt;总是“failover”,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># &lt;role&gt;是“leader”或者“observer”中的一个。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> client-reconfig-script</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mymaster</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/redis/reconfig.sh</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 一般都是由运维来配置！</span></span></code></pre></div></details><h2 id="哨兵模式概述" tabindex="-1">哨兵模式概述 <a class="header-anchor" href="#哨兵模式概述" aria-label="Permalink to &quot;哨兵模式概述&quot;">​</a></h2><p>哨兵模式是一个分布式系统，可以在一个架构中运行多个哨兵进程，这些进程使用流言协议来接收关于 Master 主服务器是否下线的信息，并使用投票协议来决定是否执行自动故障转移，以及选择哪个 Slave 作为新的 Master。</p><h3 id="作用" tabindex="-1">作用 <a class="header-anchor" href="#作用" aria-label="Permalink to &quot;作用&quot;">​</a></h3><p>在没有哨兵模式之前，我们主服务器出现宕机情况时，Redis 需要我们手动去干预主从模式的切换。然而人工干预的操作费事费力，还会造成一段时间服务不能使用；有了哨兵模式之后，主从模式的切换不需要我们人工干预。</p><h3 id="什么是哨兵模式" tabindex="-1">什么是哨兵模式 <a class="header-anchor" href="#什么是哨兵模式" aria-label="Permalink to &quot;什么是哨兵模式&quot;">​</a></h3><p>哨兵模式是一个独立的进程，它对 Redis 的系统运行状态进行监控，有两个功能：</p><ol><li>通过发送命令，让 Redis 服务器返回监控其运行状态，即监控主机和从机 Redis 是否运行正常。</li><li>当哨兵检测到主机宕机，会自动将 slave 切换成 master ，然后通过发布订阅模式通知其他的从服务器，修改配置，让他们切换master。</li></ol><h3 id="哨兵模式工作原理" tabindex="-1">哨兵模式工作原理 <a class="header-anchor" href="#哨兵模式工作原理" aria-label="Permalink to &quot;哨兵模式工作原理&quot;">​</a></h3><p>单哨兵工作原理：</p><img src="https://raw.githubusercontent.com/Noah2Y/img/main/blog/20240710150541.jpg" style="zoom:80%;"><p>单个哨兵，由一个哨兵监控多个 Redis 服务。</p><p>::: tips TIPS🤔</p><p>设想: 哨兵作为单独的一个进程，且在单哨兵环境下，如果哨兵服务出现宕机，那该如何应对？</p><p>:::</p><p>多哨兵工作原理：</p><img src="https://raw.githubusercontent.com/Noah2Y/img/main/blog/20240710153346.jpg" style="zoom:80%;"><p>假设 Master 宕机，哨兵01先检测到结果，系统并不会马上进行故障转移(failover)，仅仅是哨兵01主观的认为 Master 不可用，这个现象称为<strong>主观下线</strong>。当其他哨兵也检测到 Master 不可用，并且数量达到一定值时，那么哨兵之间会进行一次投票，投票的结果由一个哨兵发起，进行 failover 操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的 Slave 实现切换主机，这个过程称为<strong>客观下线</strong>。</p><h3 id="哨兵的功能" tabindex="-1">哨兵的功能 <a class="header-anchor" href="#哨兵的功能" aria-label="Permalink to &quot;哨兵的功能&quot;">​</a></h3><ul><li><strong>集群监控:</strong> 负责监控主从集群中的 Master 和 Slave 进程是否正常工作。</li><li><strong>故障转移(failover):</strong> 如果 Master 宕机，会自动从 Slave 中选举出新的 Master ，进行主从切换。</li><li><strong>配置中心:</strong> 如果发生故障转移，Sentinel 负责通知客户端新的 Master 的地址。</li><li><strong>消息通知:</strong> 如果某个节点有故障，那么 Sentinel 会发送报警消息给系统管理员。</li></ul><div class="warning custom-block"><p class="custom-block-title">注意🚨</p><p>如果在故障转移操作完成，选举出来新的 Master 之后，原 Master 从宕机状态恢复，则是以从机的状态认主新的 Master。</p></div><h2 id="单哨兵模式" tabindex="-1">单哨兵模式 <a class="header-anchor" href="#单哨兵模式" aria-label="Permalink to &quot;单哨兵模式&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">环境👽</p><p>当前环境为一主二从的伪集群，其中端口6001为主机，6002、6003为从机。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">127.0.0.1:6001</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">info</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> replication</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">role:master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">connected_slaves:2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6002,state=online,offset=16688,lag=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave1:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6003,state=online,offset=16688,lag=0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid:0ff3808faa9869d0d2dddd5c58d39a029026107e</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid2:9b3a6e7e6d22a17a2f6e20efb0c6448d635eb777</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_repl_offset:16688</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">second_repl_offset:16661</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_first_byte_offset:16661</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_histlen:28</span></span></code></pre></div></div><h3 id="_1-创建sentinel-conf" tabindex="-1">1.创建sentinel.conf <a class="header-anchor" href="#_1-创建sentinel-conf" aria-label="Permalink to &quot;1.创建sentinel.conf&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 创建文件夹，复制 Redis 根目录下的 sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 原 sentinel.conf 留作备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sentinel.conf</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  sentinel/sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sentinel/</span></span></code></pre></div><h3 id="_2-修改sentinel-conf" tabindex="-1">2.修改sentinel.conf <a class="header-anchor" href="#_2-修改sentinel-conf" aria-label="Permalink to &quot;2.修改sentinel.conf&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># sentinel monitor 名称 host port quorum</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span></code></pre></div><p>quorum 表示至少有 quorum 个哨兵认为主机宕机，该主机才会被判断为宕机。</p><h3 id="_3-启动哨兵" tabindex="-1">3.启动哨兵 <a class="header-anchor" href="#_3-启动哨兵" aria-label="Permalink to &quot;3.启动哨兵&quot;">​</a></h3><p>运行 redis目录下的 redis-sentinel 并指定上面修改的配置文件即可，默认端口为26379</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@localhost redis-7.2.5]# bin/redis-sentinel sentinel/sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.681</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.681</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> oO0OoO0OoO0Oo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Redis</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> starting</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> oO0OoO0OoO0Oo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.681</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Redis</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> version=7.2.5,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bits=64,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> commit=00000000,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> modified=0,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pid=8621,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> just</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> started</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.681</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loaded</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.682</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Increased</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> maximum</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> number</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> open</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> files</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10032</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (it </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">was</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> originally</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.682</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> monotonic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clock:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> POSIX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clock_gettime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">                _._</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">           _.-</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">__</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;-._</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      _.-</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`\`</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    \`</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">_.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &#39;&#39;-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           Redis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7.2.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (00000000/0) 64 bit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  .-</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> .-</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`\`\`</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  \`\`\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    _.,_</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;-._</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;      ,       .-\`  | \`,    )     Running in sentinel mode</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> |\`-._\`-...-\` __...-.\`\`-._|&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\` </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">_.-&#39;|     Port: 26379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> |    \`-._   \`._    /     _.-&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8621</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-./</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  _.-&#39;    _.-&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> |    \`-._\`-._        _.-&#39;_.-&#39;    |           https://redis.io</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  \`-._    \`-._\`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-.__.-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;    _.-&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">_.-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> |    \`-._\`-._        _.-&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">_.-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;    |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  \`-._    \`-._\`-.__.-&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">_.-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;    _.-&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-.__.-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;    _.-&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">-._</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        _.-&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">              \`-.__.-&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.682 </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.684 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel new configuration saved on disk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.684 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel ID is af95d6a8f3bc17761be985c2a2151fc86ccf19fc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.684 </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># +monitor master myredis 127.0.0.1 6001 quorum 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.684 </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># +monitor master mymaster 127.0.0.1 6379 quorum 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.684 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave slave 127.0.0.1:6002 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @ myredis </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.685 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel new configuration saved on disk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.685 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave slave 127.0.0.1:6003 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @ myredis </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.685 </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel new configuration saved on disk</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.684</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6002</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">8621:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:12:32.685</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span></code></pre></div><p>从上面输入的信息可以看出 6002、6003为 Slave，6001为Master。</p><h3 id="_5-测试哨兵" tabindex="-1">5.测试哨兵 <a class="header-anchor" href="#_5-测试哨兵" aria-label="Permalink to &quot;5.测试哨兵&quot;">​</a></h3><h4 id="_5-1-从机宕机" tabindex="-1">5.1 从机宕机 <a class="header-anchor" href="#_5-1-从机宕机" aria-label="Permalink to &quot;5.1 从机宕机&quot;">​</a></h4><p>kill 从机线程</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[MichstaBe@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]$ ps -ef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">polkitd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    1732</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   1658</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:6379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2501</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2534</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6002</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2556</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2637</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2129</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2639</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2637</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      10622</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2066</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:18</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-sentinel</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:26379</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [sentinel]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Michsta+</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  10844</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  10709</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:18</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --color=auto</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[MichstaBe@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]$ sudo kill -s 9 2556</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[MichstaBe@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]$ ps -ef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">polkitd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    1732</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   1658</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:6379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2501</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2534</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6002</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2637</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2129</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2639</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2637</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      11362</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2066</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:19</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-sentinel</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:26379</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [sentinel]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Michsta+</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  11746</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  10709</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:20</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --color=auto</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis</span></span></code></pre></div><p>sentinel输出日志:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:21:13.307</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +sdown slave 127.0.0.1:6003 127.0.0.1 6003 @ myredis 127.0.0.1 6001</span></span></code></pre></div><p>重新启动从机:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[MichstaBe@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]$ ps -ef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">polkitd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    1732</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   1658</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-server</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:6379</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2501</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">       2534</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 7月10</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       00:00:02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6002</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      11362</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   2066</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:19</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-sentinel</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:26379</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [sentinel]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      12672</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:23</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bin/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Michsta+</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  12775</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  10709</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:23</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pts/2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --color=auto</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis</span></span></code></pre></div><p>sentinel:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:23:23.126</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +reboot</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:23:23.193</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # -sdown slave 127.0.0.1:6003 127.0.0.1 6003 @ myredis 127.0.0.1 6001</span></span></code></pre></div><p>查看主从详情：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">127.0.0.1:6001</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">info</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> replication</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">role:master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">connected_slaves:2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6002,state=online,offset=69689,lag=0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave1:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6003,state=online,offset=69689,lag=0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid:0ff3808faa9869d0d2dddd5c58d39a029026107e</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid2:9b3a6e7e6d22a17a2f6e20efb0c6448d635eb777</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_repl_offset:69689</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">second_repl_offset:16661</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_first_byte_offset:16661</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_histlen:53029</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">总结😎</p><p>Slave 出现宕机情况，不会干涉其他服务运行。当宕机的 Slave 从宕机状态变成正常运行状态，会自动认主当前 Master。</p></div><h4 id="_5-2-主机宕机" tabindex="-1">5.2 主机宕机 <a class="header-anchor" href="#_5-2-主机宕机" aria-label="Permalink to &quot;5.2 主机宕机&quot;">​</a></h4><p>进入主机，执行 shutdown 命令 关闭主机服务：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">127.0.0.1:6001</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">shutdown</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">0.71s</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> connecte</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span></code></pre></div><p>sentinel输出日志：</p><ul><li>由输出日志可以观察出 6001 出现宕机，并且执行 failover 操作，将 Master 转移给了 6002。</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.601</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +sdown master myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.602</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +odown master myredis 127.0.0.1 6001 #quorum 1/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.602</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +new-epoch 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.602</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +try-failover master myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.603</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> saved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.603</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +vote-for-leader af95d6a8f3bc17761be985c2a2151fc86ccf19fc 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.603</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +elected-leader master myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.603</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +failover-state-select-slave master myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.664</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +selected-slave slave 127.0.0.1:6002 127.0.0.1 6002 @ myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.664</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +failover-state-send-slaveof-noone</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6002</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:25.731</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +failover-state-wait-promotion</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6002</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:26.636</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> saved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:26.636</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +promoted-slave slave 127.0.0.1:6002 127.0.0.1 6002 @ myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:26.636</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +failover-state-reconf-slaves master myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:26.737</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave-reconf-sent</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.733</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave-reconf-inprog</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.734</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave-reconf-done</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.805</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +failover-end master myredis 127.0.0.1 6001</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.805</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +switch-master myredis 127.0.0.1 6001 127.0.0.1 6002</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.805</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6003</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6003</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.805</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6001</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:27.806</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> saved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:31:57.867</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # +sdown slave 127.0.0.1:6001 127.0.0.1 6001 @ myredis 127.0.0.1 6002</span></span></code></pre></div><p>查看当前主从关系：</p><ul><li>可以看得出来，当前6002只有一台 slave，这台slave的端口是6003。</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">127.0.0.1:6002</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">info</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> replication</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">role:master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">connected_slaves:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6003,state=online,offset=91053,lag=0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid:daa140a0ae602200902b3d67145666bfeefd7c59</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid2:0ff3808faa9869d0d2dddd5c58d39a029026107e</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_repl_offset:91053</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">second_repl_offset:90357</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_first_byte_offset:16661</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_histlen:74393</span></span></code></pre></div><p>启动6001:</p><ul><li>sentinel输出下面语句，表示6001以从机身份连接到主机6002。</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">11362:X</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Jul</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 00:38:19.081</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +convert-to-slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> slave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 127.0.0.1:6001</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> @</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> myredis</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6002</span></span></code></pre></div><p>查看当前主从关系:</p><ul><li>由日志信息能够看出，当前6002主机拥有两台从机，端口分别是6001、6003。</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">127.0.0.1:6002</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">info</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> replication</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Replication</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">role:master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">connected_slaves:2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6003,state=online,offset=123428,lag=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave1:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6001,state=online,offset=123428,lag=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid:daa140a0ae602200902b3d67145666bfeefd7c59</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_replid2:0ff3808faa9869d0d2dddd5c58d39a029026107e</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_repl_offset:123428</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">second_repl_offset:90357</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_first_byte_offset:16661</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_histlen:106768</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">总结😎</p><p>如果主机出现宕机，经过哨兵发送的心跳包，检测到主机确实宕机，那么哨兵将会进行选举投票。从存活的从机里投票选举一个主机出来。如果故障转移完成，原主机重新正常运行，那么原主机会以从机的身份连接到新的主机。</p></div>`,63);function m(s,u,v,b,f,_){const l=t,k=e("ClientOnly");return h(),F("div",null,[c,r(k,null,{default:d(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(h(),y(l,{key:0,article:s.$frontmatter},null,8,["article"])):D("",!0)]}),_:1}),B])}const x=p(o,[["render",m]]);export{q as __pageData,x as default};
